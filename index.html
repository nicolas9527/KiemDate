<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>KIá»‚M DATE</title>
<style>
body{font-family:system-ui;background:#f0f4f8;padding:12px}
.app{max-width:480px;margin:auto}
h1{text-align:center;color:#1976d2}
.box{background:#fff;padding:16px;border-radius:16px;margin-bottom:12px}
input,button{width:100%;height:44px;margin-top:8px;border-radius:12px;border:1px solid #ccc;font-size:15px}
button{background:#1976d2;color:#fff;font-weight:bold;border:none}
.item{background:#fff;padding:14px;border-radius:14px;margin-bottom:10px;border-left:6px solid #ccc}
.red{border-left-color:#d32f2f;background:#fff5f5}
.orange{border-left-color:#ff9800;background:#fffaf2}
small{color:#555}
</style>
</head>
<body>

<div class="app">
<h1>ðŸ“… KIá»‚M DATE</h1>

<div class="box">
<input id="sku" placeholder="SKU / Barcode">
<input id="name" placeholder="TÃªn sáº£n pháº©m">
<input id="hsd" type="date">
<button onclick="save()">ðŸ’¾ LÆ°u</button>
</div>

<div class="box">
<button onclick="exportCSV()">ðŸ“¤ Xuáº¥t CSV</button>
<input type="file" id="csv" onchange="importCSV(this)" accept=".csv">
</div>

<div id="list"></div>
</div>

<script>
let data = JSON.parse(localStorage.getItem('dates_v2')||'[]');

function save(){
  const sku=sku.value.trim();
  const name=nameI.value.trim()||'Sáº£n pháº©m';
  const hsd=hsdI.value;
  if(!sku||!hsd){alert('Thiáº¿u SKU hoáº·c HSD');return}
  data.push({sku,name,hsd});
  localStorage.setItem('dates_v2',JSON.stringify(data));
  sku.value=nameI.value=hsdI.value='';
  render();
}

const skuI=document.getElementById('sku');
const nameI=document.getElementById('name');
const hsdI=document.getElementById('hsd');

function daysLeft(h){
  return Math.ceil((new Date(h+'T23:59:59')-Date.now())/86400000);
}

function render(){
  list.innerHTML='';
  data.forEach((i,idx)=>{
    const d=daysLeft(i.hsd);
    let cls='',txt=`CÃ²n ${d} ngÃ y`;
    if(d<0){cls='red';txt='âŒ Háº¿t háº¡n'}
    else if(d<=30){cls='orange';txt=`â° ${d} ngÃ y`}
    list.innerHTML+=`
      <div class="item ${cls}">
        <b>${i.name}</b><br>
        <small>${i.sku}</small><br>
        HSD: ${i.hsd}<br>
        <b>${txt}</b><br>
        <button onclick="del(${idx})" style="background:#d32f2f;margin-top:6px">XoÃ¡</button>
      </div>`;
  });
}

function del(i){
  if(confirm('XoÃ¡ dÃ²ng nÃ y?')){
    data.splice(i,1);
    localStorage.setItem('dates_v2',JSON.stringify(data));
    render();
  }
}

function exportCSV(){
  let csv='sku,name,hsd\n';
  data.forEach(i=>csv+=`${i.sku},${i.name},${i.hsd}\n`);
  const a=document.createElement('a');
  a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'}));
  a.download='kiem_date.csv';
  a.click();
}

function importCSV(input){
  const r=new FileReader();
  r.onload=e=>{
    e.target.result.split(/\r?\n/).forEach(l=>{
      const p=l.split(',');
      if(p[0]&&p[0]!=='sku') data.push({sku:p[0],name:p[1]||'SP',hsd:p[2]});
    });
    localStorage.setItem('dates_v2',JSON.stringify(data));
    render();
  };
  r.readAsText(input.files[0]);
}

render();
</script>
</body>
</html>