<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#2e7d32">
<title>Ki·ªÉm Date</title>
<style>
body{font-family:-apple-system,BlinkMacSystemFont,Arial;background:linear-gradient(#eef7ee,#e3f2e1);margin:0;padding:12px}
.container{background:#fff;border-radius:18px;padding:14px;box-shadow:0 8px 20px rgba(0,0,0,.08)}
h2{text-align:center;color:#2e7d32;margin:6px 0 14px}
label{font-weight:600;color:#2e7d32}
input{width:100%;height:40px;font-size:16px;margin:6px 0 10px;border-radius:10px;border:1.5px solid #a5d6a7;background:#f1f8e9;padding:0 10px}
.btn-row{display:flex;gap:8px;margin-bottom:12px}
button{flex:1;height:36px;background:linear-gradient(#43a047,#2e7d32);color:#fff;border:none;border-radius:10px;font-size:15px}
.list{margin-top:14px}
.item{background:#f1f8e9;border-radius:12px;padding:10px;margin-bottom:8px;font-size:15px}
.item-row{display:flex;justify-content:space-between;align-items:center}
.copy{flex:none;width:auto;padding:6px 10px;font-size:14px}
.expired{color:#c62828;font-weight:600}
</style>
</head>
<body>
<div class="container">
<h2>üìÜ KI·ªÇM DATE</h2>

<label>SKU</label>
<input id="sku" placeholder="Nh·∫≠p ho·∫∑c d√°n m√£">

<div class="btn-row">
<button onclick="pasteSKU()">üìã D√°n m√£</button>
<button onclick="saveItem()">üíæ L∆∞u</button>
</div>

<label>H·∫°n s·ª≠ d·ª•ng</label>
<input type="date" id="date">

<div class="list" id="list"></div>
</div>

<script>
async function pasteSKU(){
  try{
    const t=await navigator.clipboard.readText();
    if(t) sku.value=t.trim();
  }catch{alert('Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c clipboard')}
}

function copyText(t){
  navigator.clipboard.writeText(t);
}

let db;
const req=indexedDB.open('kiemdateDB',1);
req.onupgradeneeded=e=>{
  db=e.target.result;
  db.createObjectStore('items',{keyPath:'id',autoIncrement:true});
};
req.onsuccess=e=>{db=e.target.result;loadList()};

function saveItem(){
  if(!sku.value||!date.value)return;
  const tx=db.transaction('items','readwrite');
  tx.objectStore('items').add({sku:sku.value,date:date.value,time:Date.now()});
  sku.value='';date.value='';
  tx.oncomplete=loadList;
}

function loadList(){
  const tx=db.transaction('items','readonly');
  tx.objectStore('items').getAll().onsuccess=e=>{
    const today=new Date().toISOString().slice(0,10);
    list.innerHTML='';
    e.target.result.sort((a,b)=>b.time-a.time).forEach(it=>{
      const exp=it.date<today;
      list.innerHTML+=`
      <div class="item ${exp?'expired':''}">
        <div class="item-row">
          <div>
            SKU: <b>${it.sku}</b><br>
            HSD: ${it.date} ${exp?'‚ö†Ô∏è H·∫øt h·∫°n':''}
          </div>
          <button class="copy" onclick="copyText('${it.sku}')">üìã</button>
        </div>
      </div>`;
    });
  };
}
</script>
</body>
</html>
