<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#2e7d32">
<title>Kiá»ƒm Date</title>

<style>
body{font-family:-apple-system,BlinkMacSystemFont,Arial;background:linear-gradient(#eef7ee,#e3f2e1);margin:0;padding:12px}
.container{background:#fff;border-radius:18px;padding:14px;box-shadow:0 8px 20px rgba(0,0,0,.08)}
h2{text-align:center;color:#2e7d32;margin:6px 0 14px}
label{font-weight:600;color:#2e7d32}
input{width:100%;height:40px;font-size:16px;margin:6px 0 10px;border-radius:10px;border:1.5px solid #a5d6a7;background:#f1f8e9;padding:0 10px}
.btn-row{display:flex;gap:8px;margin-bottom:12px}
button{flex:1;height:36px;background:linear-gradient(#43a047,#2e7d32);color:#fff;border:none;border-radius:10px;font-size:15px}
.list{margin-top:14px}
.item{background:#f1f8e9;border-radius:12px;padding:10px;margin-bottom:8px;font-size:15px}
.item-row{display:flex;justify-content:space-between;align-items:center}
.copy{padding:6px 10px;font-size:14px}
.warn30{background:#fff8e1}
.warn7{background:#ffebee;color:#c62828;font-weight:600}
</style>
</head>

<body>
<div class="container">
<h2>ðŸ“† KIá»‚M DATE</h2>

<label>SKU</label>
<input id="sku" placeholder="Nháº­p hoáº·c dÃ¡n mÃ£">

<div class="btn-row">
<button onclick="pasteSKU()">ðŸ“‹ DÃ¡n mÃ£</button>
<button onclick="saveItem()">ðŸ’¾ LÆ°u</button>
</div>

<label>Háº¡n sá»­ dá»¥ng</label>
<input type="date" id="date">

<div class="list" id="list"></div>
</div>

<script>
async function pasteSKU(){
  try{
    const t=await navigator.clipboard.readText();
    if(t) sku.value=t.trim();
  }catch{}
}

function copyText(t){
  navigator.clipboard.writeText(t);
}

function fmt(d){
  const [y,m,da]=d.split('-');
  return `${da}-${m}-${y}`;
}

function daysLeft(d){
  const today=new Date();
  const exp=new Date(d+'T00:00');
  return Math.ceil((exp-today)/86400000);
}

let db;
const req=indexedDB.open('kiemdateDB',1);
req.onupgradeneeded=e=>{
  db=e.target.result;
  db.createObjectStore('items',{keyPath:'id',autoIncrement:true});
};
req.onsuccess=e=>{db=e.target.result;loadList()};

function saveItem(){
  if(!sku.value||!date.value)return;
  const tx=db.transaction('items','readwrite');
  tx.objectStore('items').add({sku:sku.value,date:date.value,time:Date.now()});
  sku.value='';date.value='';
  tx.oncomplete=loadList;
}

function loadList(){
  const tx=db.transaction('items','readonly');
  tx.objectStore('items').getAll().onsuccess=e=>{
    list.innerHTML='';
    e.target.result
      .sort((a,b)=>a.date.localeCompare(b.date))
      .forEach(it=>{
        const d=daysLeft(it.date);
        let cls='';
        if(d<=7) cls='warn7';
        else if(d<=30) cls='warn30';

        list.innerHTML+=`
        <div class="item ${cls}">
          <div class="item-row">
            <div>
              SKU: <b>${it.sku}</b><br>
              HSD: ${fmt(it.date)} (${d} ngÃ y)
            </div>
            <button class="copy" onclick="copyText('${it.sku}')">ðŸ“‹</button>
          </div>
        </div>`;
      });
  };
}
</script>
</body>
</html>
