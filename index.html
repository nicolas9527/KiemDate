<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>KIá»‚M DATE</title>

<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Arial;background:#eaf4e6;padding:14px}
.app{background:#f4faee;border-radius:22px;padding:16px;box-shadow:0 10px 25px rgba(0,0,0,.08)}
h1{text-align:center;color:#2e7d32;margin:6px 0 18px;font-size:22px}
label{color:#2e7d32;font-weight:600;display:block;margin-bottom:6px}
input{
  width:100%;height:44px;font-size:16px;border-radius:12px;
  border:2px solid #a5d6a7;background:#fff;padding:0 12px;
  box-sizing:border-box;appearance:none;-webkit-appearance:none;
  line-height:44px;margin-bottom:14px
}
.btns{display:flex;gap:12px}
button{
  flex:1;height:46px;border:none;border-radius:14px;
  font-size:16px;font-weight:600;color:#fff
}
.paste{background:#81c784}
.save{background:linear-gradient(#43a047,#2e7d32)}
.list{margin-top:20px}
.item{
  background:#fff;border-radius:14px;padding:12px;
  margin-bottom:10px;display:flex;justify-content:space-between;align-items:center
}
.item.warn30{border-left:6px solid #fbc02d}
.item.warn7{border-left:6px solid #c62828}
.copy{
  background:#e8f5e9;border:none;border-radius:10px;
  padding:6px 10px;color:#2e7d32
}
.days{font-size:13px;font-weight:600}
.w30{color:#f9a825}
.w7{color:#c62828}
</style>
</head>

<body>
<div class="app">
  <h1>ðŸ“… KIá»‚M DATE</h1>

  <label>TÃªn sáº£n pháº©m</label>
  <input id="name" placeholder="Nháº­p tÃªn sáº£n pháº©m">

  <label>SKU</label>
  <input id="sku" placeholder="Nháº­p hoáº·c dÃ¡n mÃ£">

  <label>Háº¡n sá»­ dá»¥ng</label>
  <input id="hsd" type="date">

  <div class="btns">
    <button class="paste" onclick="pasteSku()">ðŸ“‹ DÃ¡n mÃ£</button>
    <button class="save" onclick="save()">ðŸ’¾ LÆ°u</button>
  </div>

  <div class="list" id="list"></div>
</div>

<script>
let data = JSON.parse(localStorage.getItem('dates')||'[]');
let skuMap = JSON.parse(localStorage.getItem('skuMap')||'{}');

function pasteSku(){
  navigator.clipboard.readText().then(t=>{
    sku.value=t.trim();
    if(skuMap[sku.value]) name.value=skuMap[sku.value];
  });
}

function save(){
  if(!sku.value||!hsd.value) return;

  const item={
    sku:sku.value.trim(),
    name:(name.value||'').trim(),
    hsd:hsd.value,
    time:Date.now()
  };

  // LÆ¯U MAP SKU â†’ TÃŠN
  if(item.name) skuMap[item.sku]=item.name;

  data.push(item);

  localStorage.setItem('dates',JSON.stringify(data));
  localStorage.setItem('skuMap',JSON.stringify(skuMap));

  sku.value=''; name.value=''; hsd.value='';
  render();
}

function daysLeft(d){
  return Math.ceil((new Date(d+'T23:59:59')-Date.now())/86400000);
}

function render(){
  list.innerHTML='';
  data
    .sort((a,b)=>new Date(a.hsd)-new Date(b.hsd))
    .forEach(i=>{
      // BACKFILL TÃŠN Náº¾U Báº¢N GHI CÅ¨ CHÆ¯A CÃ“
      if(!i.name && skuMap[i.sku]) i.name=skuMap[i.sku];

      const d=daysLeft(i.hsd);
      let cls='', txt=`CÃ²n ${d} ngÃ y`;
      if(d<=7){cls='warn7';txt=`âš ï¸ CÃ²n ${d} ngÃ y`}
      else if(d<=30){cls='warn30';txt=`â° CÃ²n ${d} ngÃ y`}

      list.innerHTML+=`
      <div class="item ${cls}">
        <div>
          <b>${i.name||'â€”'}</b><br>
          ${i.sku}<br>
          HSD: ${i.hsd.split('-').reverse().join('-')}<br>
          <span class="days ${d<=7?'w7':d<=30?'w30':''}">${txt}</span>
        </div>
        <button class="copy" onclick="navigator.clipboard.writeText('${i.sku}')">Copy</button>
      </div>`;
    });

  localStorage.setItem('dates',JSON.stringify(data));
}
render();
</script>
</body>
</html>
