<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>KIá»‚M DATE</title>

<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Arial;background:#eaf4e6;padding:14px}
.app{background:#f4faee;border-radius:22px;padding:16px;box-shadow:0 10px 25px rgba(0,0,0,.08)}
h1{text-align:center;color:#2e7d32;margin:6px 0 18px;font-size:22px}

label{color:#2e7d32;font-weight:600;margin-bottom:6px;display:block}
input{
  width:100%;height:44px;font-size:16px;border-radius:12px;
  border:2px solid #a5d6a7;background:#fff;padding:0 12px;
  box-sizing:border-box;margin-bottom:14px
}

.btns{display:flex;gap:12px}
button{
  flex:1;height:46px;border:none;border-radius:14px;
  font-size:16px;font-weight:600;color:#fff
}
.paste{background:#81c784}
.save{background:linear-gradient(#43a047,#2e7d32)}

.list{margin-top:20px}
.item{
  background:#fff;border-radius:16px;padding:12px;
  margin-bottom:10px;border-left:6px solid #a5d6a7
}
.warn30{border-left-color:#fbc02d}
.warn7{border-left-color:#c62828}

.copy{
  margin-top:8px;background:#e8f5e9;border:none;border-radius:10px;
  padding:6px 10px;color:#2e7d32
}
.w30{color:#f9a825;font-weight:700}
.w7{color:#c62828;font-weight:700}
</style>
</head>

<body>
<div class="app">
  <h1>ðŸ“… KIá»‚M DATE</h1>

  <label>TÃªn sáº£n pháº©m</label>
  <input id="name" placeholder="Nháº­p tÃªn sáº£n pháº©m">

  <label>MÃ£ SKU</label>
  <input id="sku" placeholder="Nháº­p hoáº·c dÃ¡n mÃ£">

  <label>Háº¡n sá»­ dá»¥ng</label>
  <input id="hsd" type="date">

  <div class="btns">
    <button class="paste" onclick="pasteSku()">ðŸ“‹ DÃ¡n mÃ£</button>
    <button class="save" onclick="save()">ðŸ’¾ LÆ°u</button>
  </div>

  <div class="list" id="list"></div>
</div>

<script>
let data = JSON.parse(localStorage.getItem('dates')||'[]');
let skuMap = JSON.parse(localStorage.getItem('skuMap')||'{}');

function pasteSku(){
  navigator.clipboard.readText().then(t=>{
    sku.value=t.trim();
    if(skuMap[sku.value]) name.value=skuMap[sku.value];
  });
}

function save(){
  if(!sku.value||!hsd.value) return;

  const item={
    sku:sku.value.trim(),
    name:(name.value||'â€”').trim(),
    hsd:hsd.value
  };

  if(item.name!=='â€”') skuMap[item.sku]=item.name;

  data.push(item);
  localStorage.setItem('dates',JSON.stringify(data));
  localStorage.setItem('skuMap',JSON.stringify(skuMap));

  sku.value=''; name.value=''; hsd.value='';
  render();
}

function daysLeft(d){
  return Math.ceil((new Date(d+'T23:59:59')-Date.now())/86400000);
}

function render(){
  list.innerHTML='';
  let changed=false;

  data.sort((a,b)=>new Date(a.hsd)-new Date(b.hsd)).forEach(i=>{
    if((!i.name||i.name==='â€”') && skuMap[i.sku]){
      i.name=skuMap[i.sku];
      changed=true;
    }

    const d=daysLeft(i.hsd);
    let cls='', txt=`CÃ²n ${d} ngÃ y`, tcls='';
    if(d<=7){cls='warn7';txt=`âš ï¸ CÃ²n ${d} ngÃ y`;tcls='w7'}
    else if(d<=30){cls='warn30';txt=`â° CÃ²n ${d} ngÃ y`;tcls='w30'}

    list.innerHTML+=`
    <div class="item ${cls}">
      <b>${i.name||'â€”'}</b><br>
      SKU: ${i.sku}<br>
      HSD: ${i.hsd.split('-').reverse().join('-')}<br>
      <span class="${tcls}">${txt}</span><br>
      <button class="copy" onclick="navigator.clipboard.writeText('${i.sku}')">Copy SKU</button>
    </div>`;
  });

  if(changed) localStorage.setItem('dates',JSON.stringify(data));
}

render();
</script>
</body>
</html>
