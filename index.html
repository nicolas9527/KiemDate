<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>KIá»‚M DATE - UPDATED</title>

<style>
body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Arial;background:#eaf4e6;padding:14px}
.app{background:#f4faee;border-radius:22px;padding:16px;box-shadow:0 10px 25px rgba(0,0,0,.08); max-width: 500px; margin: auto;}
h1{text-align:center;color:#2e7d32;margin:6px 0 18px;font-size:22px}

label{color:#2e7d32;font-weight:600;margin-bottom:6px;display:block}
input{
  width:100%;height:44px;font-size:16px;border-radius:12px;
  border:2px solid #a5d6a7;background:#fff;padding:0 12px;
  box-sizing:border-box;margin-bottom:14px
}

.btns{display:flex;gap:12px}
button{
  flex:1;height:46px;border:none;border-radius:14px;
  font-size:16px;font-weight:600;color:#fff;cursor:pointer
}
.paste{background:#81c784}
.save{background:linear-gradient(#43a047,#2e7d32)}

.list{margin-top:20px}
.item{
  background:#fff;border-radius:16px;padding:12px;
  margin-bottom:10px;border-left:6px solid #a5d6a7;
  position: relative;
}
.warn30{border-left-color:#fbc02d}
.warn7{border-left-color:#c62828}

.copy{
  margin-top:8px;background:#e8f5e9;border:none;border-radius:10px;
  padding:6px 10px;color:#2e7d32; font-size: 12px;
}
.del-btn{
  position: absolute; top: 10px; right: 10px; 
  background: none; border: none; color: #ccc; font-size: 18px;
}
.w30{color:#f9a825;font-weight:700}
.w7{color:#c62828;font-weight:700}
.expired{color:#b71c1c; font-weight: 800; text-transform: uppercase;}
</style>
</head>

<body>
<div class="app">
  <h1>ðŸ“… KIá»‚M DATE</h1>

  <label>TÃªn sáº£n pháº©m</label>
  <input id="name" placeholder="Nháº­p tÃªn sáº£n pháº©m">

  <label>MÃ£ SKU</label>
  <input id="sku" placeholder="Nháº­p hoáº·c dÃ¡n mÃ£">

  <label>Háº¡n sá»­ dá»¥ng</label>
  <input id="hsd" type="date">

  <div class="btns">
    <button class="paste" onclick="pasteSku()">ðŸ“‹ DÃ¡n mÃ£</button>
    <button class="save" onclick="save()">ðŸ’¾ LÆ°u</button>
  </div>

  <div class="list" id="list"></div>
</div>

<script>
let data = JSON.parse(localStorage.getItem('dates')||'[]');
let skuMap = JSON.parse(localStorage.getItem('skuMap')||'{}');

// HÃ m dÃ¡n mÃ£ vÃ  tá»± Ä‘iá»n tÃªn náº¿u Ä‘Ã£ tá»«ng lÆ°u SKU nÃ y
function pasteSku(){
  navigator.clipboard.readText().then(t=>{
    const clipped = t.trim();
    document.getElementById('sku').value = clipped;
    if(skuMap[clipped]) {
        document.getElementById('name').value = skuMap[clipped];
    }
  });
}

function save(){
  const nameInput = document.getElementById('name');
  const skuInput = document.getElementById('sku');
  const hsdInput = document.getElementById('hsd');

  if(!skuInput.value || !hsdInput.value) {
      alert("Vui lÃ²ng nháº­p Ä‘á»§ SKU vÃ  Háº¡n sá»­ dá»¥ng!");
      return;
  }

  const finalName = (nameInput.value || 'Sáº£n pháº©m khÃ´ng tÃªn').trim();
  const finalSku = skuInput.value.trim();

  const item = {
    sku: finalSku,
    name: finalName,
    hsd: hsdInput.value
  };

  // Cáº­p nháº­t báº£n Ä‘á»“ SKU Ä‘á»ƒ láº§n sau tá»± gá»£i Ã½ tÃªn nÃ y
  skuMap[finalSku] = finalName;

  data.push(item);
  localStorage.setItem('dates', JSON.stringify(data));
  localStorage.setItem('skuMap', JSON.stringify(skuMap));

  // XÃ³a form sau khi lÆ°u
  skuInput.value = ''; nameInput.value = ''; hsdInput.value = '';
  render();
}

function deleteItem(index) {
    if(confirm("XÃ³a dÃ²ng nÃ y?")) {
        data.splice(index, 1);
        localStorage.setItem('dates', JSON.stringify(data));
        render();
    }
}

function daysLeft(d){
  // TÃ­nh toÃ¡n dá»±a trÃªn má»‘c cuá»‘i ngÃ y Ä‘á»ƒ chÃ­nh xÃ¡c hÆ¡n
  const diff = Math.ceil((new Date(d+'T23:59:59') - Date.now()) / 86400000);
  return diff;
}

function render(){
  const listDiv = document.getElementById('list');
  listDiv.innerHTML = '';

  // Sáº¯p xáº¿p theo ngÃ y gáº§n háº¿t háº¡n nháº¥t lÃªn Ä‘áº§u
  data.sort((a,b) => new Date(a.hsd) - new Date(b.hsd));

  data.forEach((i, index) => {
    const d = daysLeft(i.hsd);
    let cls = '', txt = `CÃ²n ${d} ngÃ y`, tcls = '';
    
    if (d < 0) {
        cls = 'warn7';
        txt = `âŒ ÄÃƒ Háº¾T Háº N (${Math.abs(d)} ngÃ y)`;
        tcls = 'expired';
    } else if (d <= 7) {
        cls = 'warn7';
        txt = `âš ï¸ CÃ²n ${d} ngÃ y (Gáº¥p)`;
        tcls = 'w7';
    } else if (d <= 30) {
        cls = 'warn30';
        txt = `â° CÃ²n ${d} ngÃ y`;
        tcls = 'w30';
    }

    listDiv.innerHTML += `
    <div class="item ${cls}">
      <button class="del-btn" onclick="deleteItem(${index})">Ã—</button>
      <b>${i.name}</b><br>
      <small>SKU: ${i.sku}</small><br>
      <small>HSD: ${i.hsd.split('-').reverse().join('/')}</small><br>
      <span class="${tcls}">${txt}</span><br>
      <button class="copy" onclick="navigator.clipboard.writeText('${i.sku}')">Copy SKU</button>
    </div>`;
  });
}

// Cháº¡y láº§n Ä‘áº§u khi load trang
render();
</script>
</body>
</html>
